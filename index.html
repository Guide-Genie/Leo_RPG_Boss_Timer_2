<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë ˆì˜¤ì„œë²„ ë³´ìŠ¤ íƒ€ì´ë¨¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      background-color: #121212;
      color: #e0e0e0;
      font-family: 'Noto Sans KR', sans-serif;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #ffffff;
      font-size: 2rem;
      text-align: center;
      margin-bottom: 5px;
    }
    .subtitle {
      color: #888;
      font-size: 0.9rem;
      text-align: center;
      margin-bottom: 10px;
    }
    .current-time {
      font-size: 2.4rem;
      text-align: center;
      margin-bottom: 20px;
    }
    .controls {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      gap: 10px;
      flex-wrap: wrap;
    }
    #bossFilter {
      text-align: center;
      margin: 20px 0;
      color: #ccc;
    }
    table {
      width: 100%;
      max-width: 1000px;
      margin: auto;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #444;
      padding: 6px 10px;
      white-space: nowrap;
      text-align: center;
    }
    th {
      background-color: #222;
      color: #ffcc00;
    }
    tr:nth-child(even) {
      background-color: #1a1a1a;
    }
    .highlight-10min {
      background-color: #1e442e !important;
      color: #b6ffb6 !important;
      box-shadow: 0 0 8px #b6ffb6;
    }
    .highlight-5min {
      background-color: #4b4300 !important;
      color: #ffe066 !important;
      box-shadow: 0 0 8px #ffe066;
    }
    .highlight-1min {
      background-color: #4a1a1a !important;
      color: #ff8080 !important;
      box-shadow: 0 0 8px #ff4d4d;
    }
    .highlight-30sec {
      background-color: #00334d !important;
      color: #66ccff !important;
      box-shadow: 0 0 8px #66ccff;
    }
    .highlight-next {
      outline: 2px solid #00ff99;
    }
    .summary-mode td:nth-child(n+4):nth-child(-n+8),
    .summary-mode th:nth-child(n+4):nth-child(-n+8) {
      display: none;
    }
    .filter-box label {
      margin-right: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>ë ˆì˜¤ì„œë²„ ë³´ìŠ¤ íƒ€ì´ë¨¸</h1>
  <div class="subtitle">by W_Pl</div>
  <div class="current-time" id="currentTime"></div>
  <div class="controls">
    <label>ğŸ”Š ì•ŒëŒ ë³¼ë¥¨</label>
    <input type="range" min="0" max="1" step="0.01" id="volumeSlider" />
    <button onclick="playTestSound()">ë³¼ë¥¨ í…ŒìŠ¤íŠ¸</button>
    <button onclick="toggleSummary()">ğŸ“± ìš”ì•½ ëª¨ë“œ</button>
    <button onclick="toggle10MinFilter(this)">ğŸ•™ 10ë¶„ ì´í•˜ ë³´ê¸°</button>
    <span>ì¼ê´„ ì ìš©/í•´ì œ:</span>
    <button onclick="toggleAll(10)">10ë¶„ ì „</button>
    <button onclick="toggleAll(5)">5ë¶„ ì „</button>
    <button onclick="toggleAll(1)">1ë¶„ ì „</button>
    <button onclick="toggleAll(0.5)">30ì´ˆ ì „</button>
  </div>
  <div id="bossFilter" class="filter-box"></div>
  <table>
    <thead>
      <tr>
        <th>êµ¬ë¶„</th>
        <th>ë³´ìŠ¤ëª…</th>
        <th>ìœ„ì¹˜</th>
        <th>ì   ì‹œê°„</th>
        <th>10ë¶„ ì „</th>
        <th>5ë¶„ ì „</th>
        <th>1ë¶„ ì „</th>
        <th>30ì´ˆ ì „</th>
        <th>ë‚¨ì€ ì‹œê°„</th>
        <th>ì²˜ì¹˜ì‹œ í´ë¦­</th>
      </tr>
    </thead>
    <tbody id="bossTable"></tbody>
  </table>
  <audio id="alarm1min"><source src="audio/boss_1min.mp3" type="audio/mpeg" /></audio>
  <audio id="alarm5min"><source src="audio/boss_5min.mp3" type="audio/mpeg" /></audio>
  <audio id="alarm10min"><source src="audio/boss_10min.mp3" type="audio/mpeg" /></audio>
  <audio id="alarm30sec"><source src="audio/boss_30sec.mp3" type="audio/mpeg" /></audio>
  <audio id="testSound"><source src="audio/Test.mp3" type="audio/mpeg" /></audio>
  <script>
const alarmData = [
  { name: "ê·¸ë£¨íŠ¸ í‚¹", type: "ë³´ìŠ¤", location: "1-5", timeText: "ë§¤ ì‹œ ì •ê°", nextTime: t => new Date(t.getFullYear(), t.getMonth(), t.getDate(), t.getMinutes() === 0 && t.getSeconds() === 0 ? t.getHours() : t.getHours() + 1, 0, 0) },
  { name: "í•´ì  ì„ ì¥", type: "ë³´ìŠ¤", location: "2-5", timeText: "ë§¤ ì‹œ 30ë¶„", nextTime: t => { const base = new Date(t); base.setSeconds(0); if (t.getMinutes() >= 30) base.setHours(base.getHours() + 1); base.setMinutes(30); return base; } },
  { name: "ì•„ì ˆ ë¸Œë£¨íŠ¸", type: "ë³´ìŠ¤", location: "3-5", timeText: "í™€ìˆ˜ ì‹œ 10ë¶„", nextTime: t => { let h = t.getHours(), m = t.getMinutes(); if (h % 2 === 0 || (h % 2 === 1 && m >= 10)) h++; if (h % 2 === 0) h++; return new Date(t.getFullYear(), t.getMonth(), t.getDate(), h, 10, 0); } },
  { name: "ìœ„ë”", type: "ë³´ìŠ¤", location: "4-5", timeText: "ì§ìˆ˜ ì‹œ 10ë¶„", nextTime: t => { let h = t.getHours(), m = t.getMinutes(); if (h % 2 === 1 || (h % 2 === 0 && m >= 10)) h++; if (h % 2 === 1) h++; return new Date(t.getFullYear(), t.getMonth(), t.getDate(), h, 10, 0); } },
  { name: "ì¿µí‘¸", type: "ë³´ìŠ¤", location: "5-1", timeText: "í™€ìˆ˜ ì‹œ 40ë¶„", nextTime: t => { let h = t.getHours(), m = t.getMinutes(); if (h % 2 === 0 || (h % 2 === 1 && m >= 40)) h++; if (h % 2 === 0) h++; return new Date(t.getFullYear(), t.getMonth(), t.getDate(), h, 40, 0); } },
  { name: "ì„œë¦¬êµ°ì£¼", type: "ë³´ìŠ¤", location: "6-4", timeText: "ì§ìˆ˜ ì‹œ 40ë¶„", nextTime: t => { let h = t.getHours(), m = t.getMinutes(); if (h % 2 === 1 || (h % 2 === 0 && m >= 40)) h++; if (h % 2 === 1) h++; return new Date(t.getFullYear(), t.getMonth(), t.getDate(), h, 40, 0); } },
  { name: "íƒ€ë½í•œ êµ°ì£¼ ì„¸ë¥´ì¹¸", type: "ë³´ìŠ¤", location: "7-4", timeText: "í™€ìˆ˜ ì‹œ 50ë¶„", nextTime: t => { let h = t.getHours(), m = t.getMinutes(); if (h % 2 === 0 || (h % 2 === 1 && m >= 50)) h++; if (h % 2 === 0) h++; return new Date(t.getFullYear(), t.getMonth(), t.getDate(), h, 50, 0); } },
  { name: "ìŠ¬ë¼ì„í‚¹", type: "ë¯¸ë‹ˆë³´ìŠ¤", location: "1-2", timeText: "30ë¶„ ê°„ê²©", intervalMin: 30 },
  { name: "ë¡­ìŠ¤í„°í‚¹", type: "ë¯¸ë‹ˆë³´ìŠ¤", location: "2-2", timeText: "30ë¶„ ê°„ê²©", intervalMin: 30 },
  { name: "ìŠ¤í†¤ ê³¨ë ˜", type: "ë¯¸ë‹ˆë³´ìŠ¤", location: "3-2", timeText: "45ë¶„ ê°„ê²©", intervalMin: 45 },
  { name: "ë¦¬ì¹˜í‚¹", type: "ë¯¸ë‹ˆë³´ìŠ¤", location: "4-3", timeText: "45ë¶„ ê°„ê²©", intervalMin: 45 },
  { name: "í•´ë¨¸ë¡œë“œ", type: "ë¯¸ë‹ˆë³´ìŠ¤", location: "5-4", timeText: "45ë¶„ ê°„ê²©", intervalMin: 45 },
  { name: "ì„¤ì› í¬ì‹ì ì•„í¬", type: "ë¯¸ë‹ˆë³´ìŠ¤", location: "6-2", timeText: "60ë¶„ ê°„ê²©", intervalMin: 60 },
  { name: "ë¶„ëŒ€ì¥ ì›¬ë””ê³ ", type: "ë¯¸ë‹ˆë³´ìŠ¤", location: "7-2", timeText: "60ë¶„ ê°„ê²©", intervalMin: 60 },
];

// ì´í›„ ì „ì²´ ë³´ìŠ¤ í•„í„°, ì•ŒëŒ ì„¤ì •, UI ìƒì„±, íƒ€ì´ë¨¸ ë“± í¬í•¨í•œ full js êµ¬í˜„ ì´ì–´ì„œ ì‚½ì… ì˜ˆì •

// ì•„ë˜ ì½”ë“œë¡œ ì´ì–´ì„œ ì „ì²´ ê¸°ëŠ¥ í¬í•¨
window.addEventListener('DOMContentLoaded', () => {
  const bossTable = document.getElementById('bossTable');
  const volumeSlider = document.getElementById('volumeSlider');
  const currentTime = document.getElementById('currentTime');
  const alarms = {
    10: document.getElementById('alarm10min'),
    5: document.getElementById('alarm5min'),
    1: document.getElementById('alarm1min'),
    0.5: document.getElementById('alarm30sec')
  };

  let alarmStates = JSON.parse(localStorage.getItem('alarmStates') || '{}');
  let miniRespawn = {};
  let triggered = {};
  let filterState = JSON.parse(localStorage.getItem('bossFilterState') || '{}');
  let summaryMode = false;
  let filter10 = false;

  function saveState() {
    localStorage.setItem('alarmStates', JSON.stringify(alarmStates));
    localStorage.setItem('bossFilterState', JSON.stringify(filterState));
  }

  function playTestSound() {
    document.getElementById('testSound').volume = volumeSlider.value;
    document.getElementById('testSound').play();
  }

  window.playTestSound = playTestSound;

  function getNextTime(boss) {
    if (boss.type === 'ë¯¸ë‹ˆë³´ìŠ¤') return miniRespawn[boss.name] || 0;
    return boss.nextTime(new Date());
  }

  function updateTable() {
    const now = new Date();
    currentTime.textContent = now.toLocaleTimeString();

    let nextMin = Infinity;
    let nextName = null;

    alarmData.forEach(boss => {
      const row = document.getElementById(`row-${boss.name}`);
      const t = getNextTime(boss);
      const remain = Math.floor((t - now) / 1000);

      if (remain < nextMin) {
        nextMin = remain;
        nextName = boss.name;
      }

      const td = row.querySelector('.remain');
      if (remain >= 0) {
        const m = Math.floor(remain / 60);
        const s = remain % 60;
        td.textContent = `${m}ë¶„ ${s}ì´ˆ`;
      } else {
        td.textContent = '-';
      }

      row.classList.remove('highlight-10min', 'highlight-5min', 'highlight-1min', 'highlight-30sec', 'highlight-next');
      if (boss.name === nextName) row.classList.add('highlight-next');
      if (remain <= 30 && remain >= 0) row.classList.add('highlight-30sec');
      else if (remain <= 60) row.classList.add('highlight-1min');
      else if (remain <= 300) row.classList.add('highlight-5min');
      else if (remain <= 600) row.classList.add('highlight-10min');

      [10, 5, 1, 0.5].forEach(min => {
        const key = boss.name + '_' + min;
        if (alarmStates[key] && remain === Math.floor(min * 60) && !triggered[key]) {
          alarms[min].volume = volumeSlider.value;
          alarms[min].play();
          triggered[key] = true;
        }
        if (remain > Math.floor(min * 60)) triggered[key] = false;
      });
    });
  }

  function createRow(boss) {
    const row = document.createElement('tr');
    row.id = `row-${boss.name}`;
    row.innerHTML = `
      <td>${boss.type}</td>
      <td>${boss.name}</td>
      <td>${boss.location}</td>
      <td>${boss.timeText}</td>
      ${[10,5,1,0.5].map(min => {
        const key = boss.name + '_' + min;
        const checked = alarmStates[key] ? 'checked' : '';
        return `<td><input type="checkbox" onchange="alarmStates['${key}']=this.checked;saveState();" ${checked}></td>`;
      }).join('')}
      <td class="remain">-</td>
      <td>${boss.type === 'ë¯¸ë‹ˆë³´ìŠ¤' ? `<button onclick="setMiniRespawn('${boss.name}', ${boss.intervalMin})">ì²˜ì¹˜</button>` : '-'}</td>
    `;
    return row;
  }

  function renderBossFilter() {
    const box = document.getElementById('bossFilter');
    box.innerHTML = alarmData.map(b => `<label><input type="checkbox" onchange="filterState['${b.name}']=this.checked;saveState();renderTable();" ${filterState[b.name]!==false?'checked':''}/> ${b.name}</label>`).join(' ');
  }

  function renderTable() {
    bossTable.innerHTML = '';
    alarmData.forEach(b => {
      if (filterState[b.name] !== false) bossTable.appendChild(createRow(b));
    });
  }

  window.saveState = saveState;
  window.filterState = filterState;
  window.alarmStates = alarmStates;
  window.setMiniRespawn = (name, min) => {
    miniRespawn[name] = new Date(Date.now() + min * 60000);
    renderTable();
  };
  window.toggleAll = (min) => {
    const state = alarmData.some(b => alarmStates[b.name + '_' + min]);
    alarmData.forEach(b => alarmStates[b.name + '_' + min] = !state);
    saveState();
    renderTable();
  };
  window.toggle10MinFilter = (btn) => {
    filter10 = !filter10;
    btn.textContent = filter10 ? 'ğŸ” ì „ì²´ ë³´ê¸°' : 'ğŸ•™ 10ë¶„ ì´í•˜ ë³´ê¸°';
    renderTable();
  };
  window.toggleSummary = () => {
    summaryMode = !summaryMode;
    document.querySelector('table').classList.toggle('summary-mode', summaryMode);
  };

  renderBossFilter();
  renderTable();
  updateTable();
  setInterval(updateTable, 1000);
});

</script>
</body>
</html>
